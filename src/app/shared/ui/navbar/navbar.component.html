<nav class="bg-[#f8f9fa] h-16 xl:flex items-center justify-between px-10">
  <!-- Logo of the application -->
  <div class="relative app-menu-container">
    <img (click)="toggleAppMenu($event)" src="sanmina/sanmina-100x56.png"
      class="h-14 object-cover cursor-pointer pt-1 xl:pt-0" alt="" />
    @if (showAppMenu) {
    <div @dropdown class="absolute max-h-96 w-72 left-0 top-16 bg-white rounded-2xl shadow-xl z-10">
      <div class="rounded-t-2xl px-4 h-9 w-full text-sm text-white font-semibold bg-[#505760] items-center flex">
        Informacion de la aplicacion
      </div>
      <div class="p-2">
        <div class="flex flex-col">
          <span class="text-blue-600">{{ applicationConfig.applicationName }}</span>
          <span>v: {{ applicationConfig.applicationVersion }}</span>
        </div>
        <div class="flex flex-col">
          <span class="text-blue-600">Master Page</span>
          <span>
            v:
            {{ applicationConfig.masterPageVersionApp }}
          </span>
        </div>
      </div>
    </div>
    }
  </div>

  <div id="menu"
    class="w-0 invisible xl:visible px-2 py-14 xl:py-0 xl:px-0 xl:flex items-center xl:space-x-2 fixed right-0 top-0 h-full bg-white xl:w-auto xl:bg-transparent xl:relative transition-all duration-300 ease-in-out z-[2]">
    <div class="flex flex-col xl:flex-row gap-2">
      @for (item of menu(); track item.id) {
      @if (item.idFatherMenu === null) {
      <div class="relative group">
        <button matRipple [routerLink]="item.link" routerLinkActive="bg-gray-500 bg-opacity-20 rounded-lg text-gray-600"
          class="text-gray-500 w-full hover:text-gray-600 px-4 py-2 transition-all hover:bg-gray-500 hover:bg-opacity-10 hover:rounded-lg space-x-2 flex items-center">
          @if (item.icon) {
          <fa-icon [icon]="item.icon" />
          }
          <span>{{ item.name }}</span>
        </button>

        <!-- Add invisible bridge to maintain hover -->
        <div class="absolute w-full h-2 bg-transparent"></div>

        <!-- Dropdown menu with hover bridge -->
        <div
          class="absolute mt-2 left-0 w-48 invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-all duration-150 bg-white shadow-lg rounded-lg z-10">
          @for (child of menu(); track child.id) {
          @if (child.idFatherMenu?.toString() === item.id.toString()) {
          <button matRipple [routerLink]="child.link" routerLinkActive="bg-gray-500 bg-opacity-20"
            class="w-full text-left text-gray-500 hover:text-gray-600 px-4 py-2 transition-all hover:bg-gray-500 hover:bg-opacity-10 space-x-2 flex items-center rounded-lg">
            @if (child.icon) {
            <fa-icon [icon]="child.icon" />
            }
            <span>{{ child.name }}</span>
          </button>
          }
          }
        </div>
      </div>
      }
      }
    </div>

    <!-- User iformation -->
    <div class="xl:flex items-center xl:space-x-4 xl:px-0 py-3 space-y-4 xl:space-y-0">
      <div class="flex space-x-2 items-center justify-center">
        <div class="relative user-menu-container">
          <img (click)="toggleUserMenu($event)" [src]="user?.googleImage ? user?.googleImage : userImage()"
            class="h-9 w-9 cursor-pointer rounded-full" />
          @if (showUserMenu) {
          <div @dropdown class="absolute max-h-96 w-80 -left-32 xl:-left-20 top-10 bg-white rounded-2xl shadow-xl z-10">
            <div class="rounded-t-2xl px-4 h-9 w-full text-sm text-white font-semibold bg-[#505760] items-center flex">
              Usuario
            </div>
            <div class="p-2 flex space-x-4 items-center">
              <img [src]="user?.googleImage ? user?.googleImage : userImage()" alt="User profile"
                class="h-16 w-16 rounded-full border-2 border-[#e54a4a] " />
              <div>
                <p class="text-sm text-gray-600">Nombre: <span class="text-gray-500">{{user?.name + " " +
                    user?.lastName}}</span>
                </p>
                <p class="text-sm text-gray-600">Numero de empleado: <span
                    class="text-gray-500">{{user?.employeeNumber}}</span></p>
                <p class="text-sm text-gray-600">Sesion inciada por: <span class="text-gray-500">{{loginType}}</span>
                </p>
              </div>
            </div>
          </div>
          }
        </div>

        <span class="text-gray-500 uppercase text-xs">{{
          user?.userName
          }}</span>
      </div>
      <button (click)="logout()" matRipple
        class="text-white hover:bg-[#ff6262]/80 bg-[#ff6262] border-b-4 border border-[#e54a4a] transition-all rounded-full h-10 w-full xl:w-10 inline-block">
        <fa-icon [icon]="faPowerOff" />
      </button>
    </div>
  </div>

  <!-- Appears only in mobile, to toggle menu sidebar -->
  <button (click)="toggleMenu()"
    class="text-gray-500 text-xl absolute right-2 top-2.5 hover:text-gray-600 px-4 py-2 xl:hidden transition-all hover:bg-gray-500 hover:bg-opacity-10 hover:rounded-lg space-x-2 z-[3]">
    <fa-icon [icon]="faBars" />
  </button>
</nav>

<!-- Sites and projects selector -->
<div
  class="bg-[#505760] h-8 shadow flex justify-end items-center px-1 xl:px-12 space-x-5 border-t-[3px] border-red-600">
  
  <div class="relative sites-container">
    <button matRipple (click)="toggleSites($event)" class="flex items-center space-x-1 text-gray-200 text-sm">
      <span>{{ siteSelected()?.name }}</span>
      <fa-icon [icon]="faArrowDown" />
    </button>

    @if (showSites) {
    <div @dropdown
      class="absolute max-h-96 overflow-auto right-0 mt-2 w-48 bg-white border border-gray-200 rounded-2xl shadow-lg z-10">
      <div class="rounded-t-2xl px-4 h-9 w-full text-sm text-white font-semibold bg-[#505760] items-center flex">
        Sitios
      </div>
      @for (site of sites; track site.idSite) {
      <button matRipple (click)="selectSite(site)"
        class="w-full px-4 py-2 text-left text-gray-700 hover:bg-gray-100 last:rounded-b-2xl flex items-center justify-between h-10">
        <span class="text-sm">{{site.name}}</span>
        @if (siteSelected()?.id === site.idSite) {
        <fa-icon [icon]="faCheck" class="text-[#ff6262]" />
        }
      </button>
      }
    </div>
    }
  </div>
</div>